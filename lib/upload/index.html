<!DOCTYPE html>
<html>
  <head>
    <title>host</title>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
   <!--  <script src="/lib/upload/js/controller.js"></script>
    <script src="nwk/lib/upload/js/controller.js"></script> -->

    <style>
      #progress_bar {
        margin: 10px 0;
        padding: 3px;
        border: 1px solid #000;
        font-size: 14px;
        clear: both;
        opacity: 0;
        -moz-transition: opacity 1s linear;
        -o-transition: opacity 1s linear;
        -webkit-transition: opacity 1s linear;
      }
      #progress_bar.loading {
        opacity: 1.0;
      }
      #progress_bar .percent {
        background-color: #99ccff;
        height: auto;
        width: 0;
      }
    </style>

  </head>
  <body>

  
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <a class="navbar-brand" href="/">peer to peer hosting</a>
    <ul class="nav navbar-nav">
      <li>
        <a id="browse">surf</a>
      </li>
      <li>
        <a id="upload">upload</a>
      </li>
    </ul>
  </nav>

    <div class="jumbotron">
      <div class="container">
        <h1> lets upload our site </h1>
        <br>

        <input type="file" id="files" name="file" />
        <button onclick="abortRead();">Cancel read</button>
        <div id="progress_bar"><div class="percent">0%</div></div>

        <button id='up'>Upload!</button>
      </div>

    </div>

  </body>
  <script>

  // controller.js
  $(document).ready(function(){

    // var reader;
    //   var progress = document.querySelector('.percent');
    //   var fifi;

    //   function abortRead() {
    //     reader.abort();
    //   }

    //   function errorHandler(evt) {
    //     switch(evt.target.error.code) {
    //       case evt.target.error.NOT_FOUND_ERR:
    //         alert('File Not Found!');
    //         break;
    //       case evt.target.error.NOT_READABLE_ERR:
    //         alert('File is not readable');
    //         break;
    //       case evt.target.error.ABORT_ERR:
    //         break; // noop
    //       default:
    //         alert('An error occurred reading this file.');
    //     };
    //   }

    //   function updateProgress(evt) {
    //     // evt is an ProgressEvent.
    //     if (evt.lengthComputable) {
    //       var percentLoaded = Math.round((evt.loaded / evt.total) * 100);
    //       // Increase the progress bar length.
    //       if (percentLoaded < 100) {
    //         progress.style.width = percentLoaded + '%';
    //         progress.textContent = percentLoaded + '%';
    //       }
    //     }
    //   }

    //   function handleFileSelect(evt) {
    //     // Reset progress indicator on new file selection.
    //     progress.style.width = '0%';
    //     progress.textContent = '0%';

    //     reader = new FileReader();
    //     reader.onerror = errorHandler;
    //     reader.onprogress = updateProgress;
    //     reader.onabort = function(e) {
    //       alert('File read cancelled');
    //     };
    //     reader.onloadstart = function(e) {
    //       document.getElementById('progress_bar').className = 'loading';
    //     };
    //     reader.onload = function(e) {
    //       // Ensure that the progress bar displays 100% at the end.
    //       progress.style.width = '100%';
    //       progress.textContent = '100%';
    //       setTimeout("document.getElementById('progress_bar').className='';", 2000);
    //     }

    //     // Read in the image file as a binary string.
    //     reader.readAsArrayBuffer(evt.target.files[0]);
    //     fifi = evt.target.files[0];
    //     console.log('fifi is set');
    //     for (var i = 0; i < fifi.length; i++) {
    //       console.log(i);
    //       console.log(fifi[i]);
    //     };
    //   }

    //   document.getElementById('files').addEventListener('change', handleFileSelect, false);



    // var files;
    // var binaryFiles;


   

    // var inputElement = document.getElementById("input");
    // var handleFiles = function() {
    //   files = inputElemtent.files; /* now you can work with the file list */
    //   //console.log(files);
    //   var myBlob = new Blob(files, {type : "text/pdf"});
    //   var reader = new FileReader(); 
    //   binaryFiles = reader.readAsBinaryString(myBlob);

    // }
    // inputElement.addEventListener("change", handleFiles, false);




    $('#up').click(function(){
      // if(fifi == null){
      //   console.log('no files');
      //   return;  
      // }
 
      // console.log(typeof fifi);
      // console.log(fifi);
      //var json_data = JSON.stringify(fifi);
      $.ajax({
        url: '/upload', 
        type: 'post',
        //data: json_data,
        success: function(data) {
          alert('just came back from the server..');

          console.log( data );
        }, 
        
      });
      

    });

  });
  </script>
</html>