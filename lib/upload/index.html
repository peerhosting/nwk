<!DOCTYPE html>
<html>
  <head>
    <title>host</title>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="javascripts/filesock.js"></script>
    <script src="javascripts/socketio.js"></script>

    
    <!-- Bootstrap JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
   <!--  <script src="/lib/upload/js/controller.js"></script>
    <script src="nwk/lib/upload/js/controller.js"></script> -->

    <style>

      .file {
        width: 50%
      }
      
      .fileWell {
        margin-right: auto;
        margin-left: auto;
      }

      .btn-file {
          position: relative;
          overflow: hidden;
      }

      .btn-file input[type=file] {
          position: absolute;
          top: 0;
          right: 0;
          min-width: 100%;
          min-height: 100%;
          font-size: 100px;
          text-align: right;
          filter: alpha(opacity=0);
          opacity: 0;
          outline: none;
          background: white;
          cursor: inherit;
          display: block;
      }

      #warn {
        display: none;
      }
      .after {
        display: none;
      }

    </style>

  </head>
  <body>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <a class="navbar-brand" href="/">colony</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="/browse">browse</a>
      </li>
      <li>
        <a href="/upload">upload</a>
      </li>
    </ul>
  </nav>


    <hr> 

    <div class="jumbotron">

      <div class="container">



        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3"> </div>
          
           
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-center input-group ">

          <!--  -->

          <form id = "uploadFile" enctype="multipart/form-data" action="/fileupload" method="post">

            <div class="form-group">
               <h2>Website Name</h2>
               <input type="text" name="name" class="form-control" id="name" placeholder="My Website">
             </div>
            <button type="button" id="uploadName">Upload name</button>
        </form>

 <!--             <br>
             <br>
             <br>
             <span class="btn btn-default btn-file">
                 Browse <input type="file", name="file", id="files" multiple/>
             </span>
             <br>
             <br>

            <div class="well fileWell" id="selectedFiles">
                
            </div>
          
            <input id="up" class="btn btn-file" type="submit" value="Upload">  



        </div> -->

        <div class="after well col-xs-3 col-sm-3 col-md-3 col-lg-3"> 

            <p><button id="upload_btn">Upload File</button></p>
            <p><button id="mk_folder">Make Folder</button></p>




        </div>

      </div>
    </div>


  </body>
  <script>

var fileArr = ['/images/css.png', '/images/html.png',  '/images/js.png', '/images/txt.png'];
  var fileToIcon = function(fileName){
    
    var selectFile = 3;
    if(fileName.split('.')[1] === 'css')
      selectFile = 0;
    else if(fileName.split('.')[1] === 'html')
      selectFile = 1;
    else if(fileName.split('.')[1] === 'js')
      selectFile = 2;


    var html = '';
    html += '<div class="col-lg-3">';
    html += '<img class="image-responsive file" src=' +fileArr[selectFile] + '>';
    html += '<p class="text-center">' + fileName + '</p>';
    html += '</div>';
    return html;
  }
  
  $(document).ready(function(){



       



    // var selDiv = "";
        
    // function init() {
    //   document.querySelector('#files').addEventListener('change', handleFileSelect, false);
    //   selDiv = document.querySelector("#selectedFiles");
    //   // var html = "<img src='/images/txt.png'><p>info.txt</p>";
    //   selDiv.innerHTML += fileToIcon('text.txt');
    // }

    // init();




    // function handleFileSelect(e) {
     
        
    //   if(!e.target.files) return;
    
    //   selDiv.innerHTML = "";
    //   var files = e.target.files;
    //     var filesArr = Array.prototype.slice.call(files);
    //     filesArr.forEach(function(f) {

    //       var reader = new FileReader();
    //       reader.onload = function (e) {
    //         // var html = "<p>" + f.name + "</p>";
    //         selDiv.innerHTML += fileToIcon(f.name);       
    //       }
    //       reader.readAsDataURL(f); 
    //     });
    // }

    // function getName(){

    //     var json = {
    //         name : $('#name').val()
    //     }
    //     return json;
    // }

    $('#uploadName').click(function(){
        $.post( "/fileupload", {
                name : $('#name').val()
            }).done(function( data ) {
                console.log(data);
                $('.after').show();

                var socket = io.connect('http://localhost:4000');
                var siofu = new SocketIOFileUpload(socket);
                

                // Configure the three ways that SocketIOFileUpload can read files:
                document.getElementById("upload_btn").addEventListener("click", siofu.prompt, false);

                siofu.addEventListener("complete", function(event){
                    console.log(event.success);
                    console.log(event.file);
                });

                siofu.addEventListener("start", function(event){
                    event.file.meta.name = data;
                });

                $('#mk_folder').click(function(){
                    socket.emit('makeDir', { name: 'cool' });
                });


              });

    });

    
  });
  </script>
</html>